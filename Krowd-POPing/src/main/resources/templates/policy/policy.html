<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="/css/policy/policy.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://kit.fontawesome.com/b3a019e595.js" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <title>정책</title>
</head>
<body>
<th:block th:replace="policy/registerHeader.html"></th:block>
<div id="wrap">
    <div class="content">
        <!--        <form name="policy-form" action="/projectReg/policyReg" method="post" enctype="multipart/form-data">-->
        <div class="box box1">
            <dl class="left">
                <dt class="left_tt">프로젝트 정책</dt>
                <dd class="left_txt">펀딩 종료 후 후원자의 불만 또는 분쟁 발생 시 중요한 기준이 될 수 있습니다. 신중히 작성해주세요.</dd>
            </dl>
            <div class="right">
                <div class="right_box">
                    <div class="right_pd">
                        <div class="info">
                            <div class="authInfo">
                                <div class="authType">
                                    <div name="file-solid"><strong>프로젝트 정책</strong></div>
                                </div>
                                <p>이 프로젝트의 정책을 기입해주세요.</p>

                            </div><button class="btn">작성하기</button>
                        </div>
                        <div class="box_modify">
                            <div class="modify">
                                <textarea id="policy_textarea" name="basicPolicy" class="comment">안녕</textarea>
                            </div>
                        </div>
                        <div class="box_hidden description">
                            <div class="hidden-box">
                                <div class="hb">
                                    <div class="modify">
                                        <div class="comment"><textarea id="basicPolicy" class="textarea1">(예시) 아래와 같은 사항을 고려해서 작성해주세요. 진행하는 프로젝트에 해당되지 않는 항목은 삭제해주세요.

· 펀딩 마감 이후에는 후원금액이 창작자에게 전달되기에 텀블벅을 통해 환불이 불가합니다. 환불은 창작자가 환불계좌를 받아 반환하는 방식으로만 가능하며, 어떤 경우에 환불이 가능한지를 기재해주세요.
· 펀딩 성사 후 지연 또는 선물 전달에 문제가 발생했을 때에 어떤 식으로 대응하시겠어요? 이 프로젝트 특성상 발생할 수 있는 문제에 대한 추가적인 정책이나 약속이 있다면 기재해주세요. (후원금 환불, 대체 보상 등)
· 배송이 필요한 선물에 문제가 발생한 경우 교환, A/S는 어떻게 진행되나요?
· 디지털 콘텐츠 리워드는 타인에게 양도가 가능한가요?
· 오프라인으로 전달되는 선물(공연, 전시 등)은 타인에게 양도가 가능한가요?</textarea></div>
                                    </div>
                                    <div class="check">
                                        <p class="text-check"></p><span class="textarea_leng textarea_leng1">412/1100</span>
                                    </div>
                                </div>
                            </div>
                            <div class="buttonWrap buttonWrap2">
                                <button type="button" class="box3_btn1" onclick="hide('box1 .box_hidden');">취소</button>
                                <button type="button" class="box3_btn2 box3_btn2_off" onclick="addText1();"><span>저장</span></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="box box2">
            <dl class="left">
                <dt class="left_tt">예상되는 어려움</dt>
                <dd class="left_txt">펀딩 진행 및 선물 전달 과정에서 발생 가능한 문제가 있다면 후원자에게 명확하게 알려주세요. 대응 계획을 함께 적는다면 후원자에게 신뢰를 줄 수 있습니다.</dd>
            </dl>
            <div class="right">
                <div class="right_box">
                    <div class="right_pd">
                        <div class="info">
                            <div class="authInfo">
                                <div class="authType">
                                    <div name="info-solid-oval" ></div><strong>예상되는 어려움</strong>
                                </div>
                                <p>프로젝트의 진행 및 선물 전달 과정에서 예상되는 어려움을 기입해주세요.</p>
                            </div><button class="btn">작성하기</button>
                        </div>
                        <div class="box_modify">
                            <div class="modify">
                                <textarea id="difficulty_area" name="difficultyInfo" class="comment"></textarea>
                            </div>
                        </div>
                        <div class="description box_hidden">
                            <div class="hidden-box">
                                <div class="hb">
                                    <div class="modify">
                                        <div class="comment"><textarea id="difficultyInfo" class="cjoUaQ textarea2">아래와 같은 사항을 고려해서 작성해보세요.

· 제작 과정에서 발생할 수 있는 변동사항이 있다면 무엇인가요? (예산, 선물 내용 등)
· 선물 전달 일정이 지연될 가능성이 있나요 ?
· 펀딩 자금이 고갈돼 선물을 전달하지 못한다면 어떤 조치를 취할 수 있을까요?
· 이외에 발생가능한 문제는 무엇이 있으며 어떻게 대응할 예정인가요?</textarea></div>
                                    </div>
                                    <div class="div1 check">
                                        <p class="div2 text-check"></p><span class="textarea_leng textarea_leng2">185/1100</span>
                                    </div>
                                </div>
                            </div>
                            <div class="buttonWrap buttonWrap2">
                                <button class="box3_btn1" onclick="hide('box2 .box_hidden');">취소</button>
                                <button class="box3_btn2 box3_btn2_off"  color="mainEditorP80" onclick="addText2();"><span>저장</span></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="box box3">
            <dl class="left">
                <dt class="left_tt">상품 정보 고시</dt>
                <dd class="left_txt">선물에 대한 더 자세한 정보를 참고할 수 있도록 상품 정보 고시를 작성해주세요.</dd>
            </dl>
            <div class="right">
                <div class="right_box">
                    <button id="write_btn" class="box3_btn" onclick="show('box3_sel')">
                        <div name="plus" ></div><i class="fa-solid fa-plus"></i>작성하기
                    </button>
                    <div class="box3_sel box_hidden">
                        <p class="box_p">상품 분류</p>
                        <div class="box3_select">
                                <span class="" onclick="show('box3_select_hidden')" readonly="">
                                    <input readonly="" id= "productType" name="product_type" type="text" inputmode="text" autocomplete="off" autocapitalize="off" class="input_form" value="액세서리" placeholder="">
                                    <input type="hidden" id="product_type_hidden" name="productType">
                                    <div name="arrow2-down" ></div>
                                </span>
                            <div class="box_hidden box3_select_hidden">
                                <div class="bPMnIA">
                                    <ul>
                                        <li value="R1_18" label="액세서리"><button type="button" value="R1_18" data-props="{&quot;fadeDown&quot;:true}">액세서리</button></li>
                                        <li value="R1_20" label="디지털 액세서리"><button type="button" value="R1_20" data-props="{&quot;fadeDown&quot;:true}">디지털 액세서리</button></li>
                                        <li value="R1_21" label="인형"><button type="button" value="R1_21" data-props="{&quot;fadeDown&quot;:true}">인형</button></li>
                                        <li value="R1_22" label="문구"><button type="button" value="R1_22" data-props="{&quot;fadeDown&quot;:true}">문구</button></li>
                                        <li value="R1_23" label="잡화"><button type="button" value="R1_23" data-props="{&quot;fadeDown&quot;:true}">잡화</button></li>
                                        <li value="R1_23" label="의류"><button type="button" value="R1_24" data-props="{&quot;fadeDown&quot;:true}">의류</button></li>
                                        <li value="R1_23" label="기타"><button type="button" value="R1_25" data-props="{&quot;fadeDown&quot;:true}">기타</button></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <ul class="hvPFpP">
                            <li>
                                <p class="sel_tt">품명</p>
                                <div class="sel_con ">
                                    <div class="sel_input">
                                            <span class="input_wrap">
                                            <input type="text" name="productName" id="productName" inputmode="text" placeholder="포장 단위별 용량(중량), 수량, 크기을(를) 입력해주세요" autocomplete="off" autocapitalize="off" class="input_form" value=""></span>
                                    </div>
                                    <div class="input_txt">
                                        <span class="txt_leng">0/1000</span>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <p class="sel_tt">용량 또는 중량</p>
                                <div class="sel_con">
                                    <div class="sel_input">
                                            <span class="input_wrap">
                                            <input type="text" name="productSize" id="productSize" inputmode="text" placeholder="생산자을(를) 입력해주세요" autocomplete="off" autocapitalize="off" class="input_form" value=""></span>
                                    </div>
                                    <div class="input_txt">
                                        <span class="txt_leng">0/1000</span>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <p class="sel_tt">소재</p>
                                <div class="sel_con">
                                    <div class="sel_input"><span class="input_wrap">
                                        <input type="text" name="material" id="material" inputmode="text" placeholder="원산지을(를) 입력해주세요" autocomplete="off" autocapitalize="off" class="input_form" value=""></span></div>
                                    <div class="input_txt">
                                        <span class="txt_leng">0/1000</span>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <p class="sel_tt">제품 주요 사양</p>
                                <div class="sel_con">
                                    <div class="sel_input"><span class="input_wrap">
                                        <input type="text" name="specification" id="specification" inputmode="text" placeholder="제조연월일(포장일 또는 생산연도), 유통기한 또는 품질유지기한을(를) 입력해주세요" autocomplete="off" autocapitalize="off" class="input_form" value=""></span></div>
                                    <div class="input_txt">
                                        <span class="txt_leng">0/1000</span>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <p class="sel_tt">사용 시 주의사항</p>
                                <div class="sel_con">
                                    <div class="sel_input"><span class="input_wrap">
                                            <input type="text" name="caution" id="caution" inputmode="text" placeholder="농산물 관련 법상 표시 사항을(를) 입력해주세요" autocomplete="off" autocapitalize="off" class="input_form" value=""></span></div>
                                    <div class="input_txt">
                                        <span class="txt_leng">0/1000</span>
                                    </div>
                                </div>
                            </li>

                        </ul>
                        <div class="buttonWrap">
                            <button class="box3_btn1" onclick="hide('box3_sel');">취소</button>
                            <!-- <button id="save" class="box3_btn2_add"  color="mainEditorP80" onclick="saveContent();"><span>저장</span></button> -->
                        </div>
                    </div>
                    <div class="box_modify">
                        <div class="icon-box">
                            <div class="icon-list">
                                <div class="title">
                                    <div class="iconTitle">
                                        <div name="category-solid" class="icon1 icon-content">
                                        </div><span>액세서리</span>
                                    </div>
                                    <div class="buttonWrap">
                                        <button class="buttonwrap1 wrap1 bw1" color="grayEditor200">수정하기</button>
                                        <button class="buttonwrap1 update iconButton fnt-p2 wrap1" color="grayEditor200">삭제하기</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="box box4 box-div">
            <dl class="left">
                <dt class="left_tt">인증 서류 제출</dt>
                <div class="file-upload">
                    <div class="noticeTitle">
                        <div name="info-line-oval" ></div>필수 서류를 꼭 확인하세요!
                    </div>
                    <div>
                        <p>제공할 선물의 종류를 모두 선택하세요. 필요한 서류 정보를 확인하실 수 있어요.</p>
                        <p>필수 서류를 제출하지 않으면 프로젝트가 반려될 수 있습니다.</p>
                    </div>
                </div>
            </dl>
            <div class="right">
                <div class="right_box">
                    <div class="right_pd bottomBlank">
                        <div class="info">
                            <div class="authInfo">
                                <div class="authType">
                                    <div name="item-solid" ></div>
                                    <strong>인증 서류 목록</strong>
                                </div>
                            </div><button class="btn">확인하기</button>
                        </div>
                        <p class="description">서류 제출 전 서류 목록을 확인해주세요.</p>
                        <div class="box_hidden">
                            <div>
                                <h5 style="color:#7c1cd8";>필수 서류</h5>
                                <p>기획/개발 증빙 서류</p>
                                <p>-창작자님의 리워드가 어떤 방식으로 기획, 개발됐는지 보여주는 서류에요.(패턴지, 작업 지시서, 도면, 또는 해당 항목들에 준하는 내용을 포함한 파일 또는 문서)</p>
                                <h5 style="color:#7c1cd8">선택 서류</h5>
                                <p>1)프로젝트 내용에 리워드의 기능, 표능, 특허 등 증빙이 필요한 내용을 작성한 경우 [특허증, 디자인 등록증 등 객관적인 자료]를 제출해주세요.</p>
                                <p>2)제작물에 사용된 소스의 저작권을 확인해주세요.
                                    -상업적 목적의 이용이 가능한 이미지, 폰트, 영상, gif를 사용해주세요. 출처 표기가 필요한 경우 이미지나 프로젝트 하단에 표기해주세요.

                            </div>
                            <div class="buttonWrap">
                                <button class="box3_btn1" onclick="hide('box4 .box_hidden');">취소</button>
                                <!-- <button class="box3_btn2"><span>완료</span></button> -->
                            </div>
                        </div>
                    </div>

                    <div class=" VibOD box4_filebox" id="fileContainer">
                        <!-- 파일 추가시 입력됨 -->
                    </div>
                    <div class="upload">
                        <input type="file" hidden id="box4_fileinput"  multiple accept=".jpg, .jpeg, .png, .pdf, .zip, .hwp, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document">
                        <label for="box4_fileinput">
                            <div class="fileUploadText">
                                파일 업로드
                            </div>
                            <p>(10MB 이하의 jpg, jpeg, png, pdf, zip, hwp 확장자 및 Word, Excel에서 작성된 문서만 가능)</p>
                        </label>
                    </div>
                </div>
            </div>
        </div>
        <div class="final_div">
            <div class="final_div">
                <button type="submit" id="final_button" onclick="save();">저장</button>
            </div>
        </div>
    </div>
    <script>

        $(function(){
            var textCountLimit = 1100;

            $(".info button").click(function(){
                if($(this).hasClass("modifybtn") == true){
                    $(this).closest(".box").find(".box_hidden").show();
                    $(this).closest(".box").find(".box_modify").hide();
                }else {
                    $(this).hide();
                    $(this).closest(".box").find(".box_hidden").show();
                    $(this).closest(".box").find(".box_modify").hide();
                }
            });
            $('textarea').on('input', function(){
                var class_name = $(this).attr('class');
                var class_idx = class_name.charAt(class_name.length - 1);
                console.log(class_idx);
                var textLength = $(this).val().length;
                $('.textarea_leng'+class_idx).text(textLength+"/"+textCountLimit);
                if (textLength > textCountLimit) {
                    $(this).val($(this).val().substr(0, textCountLimit));
                }
            });

            $('.box').each(function (index, item) {
                var idx = index + 1;
                console.log(idx);
                if(idx < 3) {
                    var textLength = $('.textarea' + idx).val().length;
                    $('.textarea_leng'+idx).text(textLength+"/"+textCountLimit);
                }
            });
            $('.sel_con input').on('input', function(){
                var txt = $(this).val().length; // 입력된 텍스트의 길이 가져오기
                $(this).closest(".sel_con").find(".txt_leng").text(txt + "/1000");
                if (txt > 1000) {
                    $(this).val($(this).val().substr(0, 1000)); // 입력된 텍스트가 1000자를 넘어가면 1000자까지 자르기
                }
            });

            $(".box3_select_hidden button").click(function(){
                var box3_li = $(this).text();
                $(".box3_select input").val(box3_li);
                $(".box3_select_hidden").hide();
                $(".box3 .iconTitle span").text(box3_li);
            });

            // 파일업로드 open 시
            $("#box4_fileinput").click(function(){
                var fileInput = document.getElementById('box4_fileinput'); // 전체 첨부파일

                // 선택 첨부파일
                var selFiles = document.querySelectorAll('.item');
                // 화면상 삭제되었는데 첨부파일 box4_fileinput에는 데이터가 남아있는 경우가 있으므로 화면건수가 0인 경우 fileInput도 삭제 처리
                if(selFiles.length === 0) {
                    // 첨부파일 삭제처리
                    fileInput.value = '';
                }
            });

            // 파일업로드 선택 시
            $("#box4_fileinput").change(function(){
                var fileInput = document.getElementById('box4_fileinput'); // 변경된 전체 첨부파일
                var files = fileInput.files;

                if (files.length > 3) {
                    var filebox = document.querySelector('.box4_filebox');
                    filebox.style.display='none';
                    alert("3개 이상의 파일을 첨부할 수 없습니다.");
                    return;
                }

                $(".box4_filebox").show();

                // fileContainer 비운 후 새로 생성
                document.getElementById('fileContainer').innerText = '';
                for(var i=0; i<files.length; i++) {
                    console.log("==== files.index : " + i);
                    appendFileInput(i);
                }
            });

            $(".box3_btn2").click(function(){
                $(this).removeClass("box3_btn2_off");
                $(this).closest(".box").find(".info button").show();
                $(this).closest(".box").find(".box_hidden ").hide();
                $(this).closest(".box").find(".info button").text("수정하기");
                $(this).closest(".box").find(".info button").addClass("modifybtn");
                $(this).closest(".box").find(".box_modify").show();

                /*if (cls_idx < 3) {
                    var textval = $(this).closest(".box").find("textarea").val();
                    console.log(textval);
                    $(this).closest(".box").find(".comment").html(textval).css("white-space", "pre-line");
                }*/
            });

            $(".modifybtn").click(function() {
                $(this).closest(".box").find(".box_hidden").show();
            })

        });
        $(document).ready(function(){
            $(window).scroll(function(){
                if ($(this).scrollTop() >= 100) {
                    $("h1").hide();
                    $("header").addClass("on");
                    $("#wrap").css("margin-top","164px");
                }else {
                    $("h1").show();
                    $("header").removeClass("on");
                    $("#wrap").css("margin-top","0");
                }
            });
        });

        function show(index){
            $("."+index).show();
        };
        function hide(index){
            $("."+index).hide();
            $("."+index).closest(".box").find(".info").find("button").show();
        };

        function saveTextPolicy() {
            var textareaValue = document.getElementById('policy_textarea').value;

            // 가져온 값을 displayArea에 표시
            document.getElementById('displayArea').innerText = textareaValue;
        }


        function addText1() {
            var inputText=document.querySelector('.textarea1').value
            var outputDiv=document.getElementById('policy_textarea')
            var input=document.querySelector('.textarea1')
            outputDiv.innerHTML=inputText
            outputDiv.readOnly=true

        }

        function addText2() {
            var inputText=document.querySelector('.textarea2').value
            var outputDiv=document.getElementById('difficulty_area')
            outputDiv.innerHTML=inputText
            outputDiv.readOnly=true
        }

        function saveContent() {
            var btn = document.getElementById('write_btn');

            // 저장 버튼 숨기기
            btn.style.display = 'none';
        }


        // 파일input append
        function appendFileInput(index) {
            var fileContainer = document.getElementById('fileContainer');
            var fileId = "item" + index; // 파일에 고유한 식별자 생성
            var fileName = document.getElementById('box4_fileinput').files[index].name;
            var newFileInput = createFileInput(fileId, fileName);
            fileContainer.appendChild(newFileInput);
        }

        // item박스 생성
        function createFileInput(fileId, fileName) {
            // 새로운 파일 업로드 입력 상자를 생성하는 함수
            var fileInputContainer = document.createElement('div');
            fileInputContainer.classList.add('bAWEdB', 'item');
            fileInputContainer.dataset.fileId = fileId; // fileId를 data-file-id 속성으로 저장

            var fileDiv = document.createElement('div');
            fileDiv.classList.add('file');

            var fileIconSpan = document.createElement('span');
            fileIconSpan.classList.add('fileIcon');

            var fileIcon = document.createElement('div');
            fileIcon.classList.add('icon1', 'icon-content');
            fileIcon.setAttribute('name', 'file-solid');

            var fileSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            fileSvg.setAttribute('viewBox', '0 0 48 48');
            var path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('fill-rule', 'evenodd');
            path.setAttribute('clip-rule', 'evenodd');
            path.setAttribute('d', 'M8 4.1C8 4.04477 8.04477 4 8.1 4H31.9586C31.9851 4 32.0105 4.01054 32.0293 4.02929L39.9707 11.9707C39.9895 11.9895 40 12.0149 40 12.0414V43.9C40 43.9552 39.9552 44 39.9 44H8.1C8.04477 44 8 43.9552 8 43.9V4.1ZM15 20.1C15 20.0448 15.0448 20 15.1 20H32.9C32.9552 20 33 20.0448 33 20.1V22.9C33 22.9552 32.9552 23 32.9 23H15.1C15.0448 23 15 22.9552 15 22.9V20.1ZM15.1 27C15.0448 27 15 27.0448 15 27.1V29.9C15 29.9552 15.0448 30 15.1 30H32.9C32.9552 30 33 29.9552 33 29.9V27.1C33 27.0448 32.9552 27 32.9 27H15.1ZM15 34.1C15 34.0448 15.0448 34 15.1 34H32.9C32.9552 34 33 34.0448 33 34.1V36.9C33 36.9552 32.9552 37 32.9 37H15.1C15.0448 37 15 36.9552 15 36.9V34.1ZM29.669 6.67066L36.8298 13.8295C36.8927 13.8924 36.8483 14 36.7594 14.0002L29.6008 14.0222C29.5454 14.0224 29.5005 13.9776 29.5005 13.9222L29.4983 6.74141C29.4982 6.65231 29.606 6.60767 29.669 6.67066Z');
            fileSvg.appendChild(path);

            fileIcon.appendChild(fileSvg);
            fileIconSpan.appendChild(fileIcon);

            var fileNameElement = document.createElement('b');
            fileNameElement.setAttribute('id', 'fileName');
            fileNameElement.textContent = fileName;

            fileDiv.appendChild(fileIconSpan);
            fileDiv.appendChild(fileNameElement);

            var deleteButtonDiv = document.createElement('div');
            deleteButtonDiv.classList.add('cpXAaG');

            var deleteButton = document.createElement('button');
            deleteButton.classList.add('buttonwrap1', 'wrap1', 'deleteButton', 'bw1');
            deleteButton.setAttribute('color', 'grayEditor200');
            deleteButton.addEventListener('click', function() {
                deleteFile(fileId); // fileId를 전달하여 해당 파일 삭제
            });

            var deleteIcon = document.createElement('div');
            deleteIcon.classList.add('icon-content');
            deleteIcon.setAttribute('name', 'delete');

            var deleteSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            deleteSvg.setAttribute('viewBox', '0 0 48 48');

            var deletePath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            deletePath.setAttribute('fill-rule', 'evenodd');
            deletePath.setAttribute('clip-rule', 'evenodd');
            deletePath.setAttribute('d', 'M38.814 42.172C38.814 42.946 38.064 43.574 37.144 43.574H10.856C9.936 43.574 9.186 42.946 9.186 42.172V12.218H38.814V42.172ZM17.564 4.426L30.542 4.524V9.794H17.462L17.564 4.426ZM44.786 9.794H32.968V4.524C32.968 3.13 31.832 2 30.436 2H17.564C16.168 2 15.03 3.13 15.03 4.524V9.794H3.212C2.542 9.794 2 10.336 2 11.006C2 11.676 2.542 12.218 3.212 12.218H6.76V42.172C6.76 44.284 8.598 46 10.856 46H37.144C39.402 46 41.24 44.284 41.24 42.172V12.218H44.786C45.456 12.218 46 11.676 46 11.006C46 10.336 45.456 9.794 44.786 9.794ZM18.857 36.9338C19.527 36.9338 20.069 36.3918 20.069 35.7218V20.0738C20.069 19.4038 19.527 18.8618 18.857 18.8618C18.187 18.8618 17.645 19.4038 17.645 20.0738V35.7218C17.645 36.3918 18.187 36.9338 18.857 36.9338ZM30.3542 35.7218C30.3542 36.3918 29.8122 36.9338 29.1422 36.9338C28.4722 36.9338 27.9302 36.3918 27.9302 35.7218V20.0738C27.9302 19.4038 28.4722 18.8618 29.1422 18.8618C29.8122 18.8618 30.3542 19.4038 30.3542 20.0738V35.7218Z');

            deleteSvg.appendChild(deletePath);
            deleteIcon.appendChild(deleteSvg);
            deleteButton.appendChild(deleteIcon);
            deleteButtonDiv.appendChild(deleteButton);

            fileInputContainer.appendChild(fileDiv);
            fileInputContainer.appendChild(deleteButtonDiv);

            return fileInputContainer;
        }

        // 파일삭제
        function deleteFile(fileId) {
            if (confirm('첨부 파일을 삭제하시겠습니까?')) {
                // fileId를 이용하여 해당 파일 업로드 상자를 찾음
                var fileIdContainer = document.querySelector(`[data-file-id="${fileId}"]`);

                if (fileIdContainer) {
                    fileIdContainer.remove();
                }
            }
        }

        // 저장클릭 시
        function save() {
            if (!confirm('저장하시겠습니까?')) {
                return;
            }

            // 선택된 파일 개수 체크
            var selFiles = document.querySelectorAll('.item'); // 선택 첨부파일
            if (selFiles.length === 0) {
                alert("첨부파일을 하나 이상 추가해주세요.");
                return;
            }
            if (selFiles.length > 3) {
                alert("3개 이상의 파일을 첨부할 수 없습니다.");
                return;
            }

            // 첨부input 파일 가져오기
            var fileInput = document.getElementById('box4_fileinput'); // 전체 첨부파일
            var files = fileInput.files;

            // 선택된 첨부파일만 저장되도록 formData 생성
            var formData = new FormData();
            var validFile = true;
            selFiles.forEach(selFile => {
                var fileId = selFile.dataset.fileId;
                var index = fileId.substring(4);

                // 파일 유효성 체크
                if (!isValidFile(files[index])) {
                    validFile = false;
                    return; // forEach문 return
                }

                formData.append('files', files[index]); // 선택된 파일만 formData append
            });

            // 유효성체크 false인 경우 return
            if(!validFile) {
                return;
            }

            // 정책입력정보 data 정리
            var policyData = {
                projectCode : '1',                              // 프로젝트코드 (!!! TOBE, 추후 이전 화면에서 불러온 값 셋팅필요 !!!)
                basicPolicy : $("#basicPolicy").val(),          // 프로젝트정책
                difficultyInfo : $("#difficultyInfo").val(),    // 예상되는어려움
                productType : $("#productType").val(),          // 상품분류
                productName : $("#productName").val(),          // 품명
                size : $("#productSize").val(),                 // 용량또는중량
                material : $("#material").val(),                // 소재
                specification : $("#specification").val(),      // 제품주요사양
                caution : $("#caution").val()                   // 사용시주의사항
            }
            formData.append("data", new Blob([JSON.stringify(policyData)], {type: "application/json"})); // mutipart file과 같이 보내려면 별도 type지정 필요

            $.ajax({
                url : "/projectReg/save",
                type : 'POST',
                data : formData,
                contentType: false,  // 필수 : x-www-form-urlencoded로 파싱되는 것을 방지
                processData: false,  // 필수: contentType을 false로 줬을 때 QueryString 자동 설정됨. 해제
                success : function(data) {
                    alert("저장되었습니다.");
                    location.reload();
                },
                error : function(req, status, error) {
                    console.log(status + " : " + error);
                }
            });
        }

        // 첨부파일 유효성 체크
        function isValidFile(file) {
            var extensions = ['jpg', 'jpeg', 'png', 'pdf', 'zip', 'hwp', 'xls', 'xlsx', 'dot', 'doc', 'docx']; // 유효 확장자
            var maxFileSize = 10 * 1024 * 1024; // 유효 파일크기 10MB
            var fileExtension = file.name.split('.').pop().toLowerCase(); // 실제 파일크기

            // 확장자 체크
            if (!extensions.includes(fileExtension)) {
                alert('지원하지 않는 확장자 파일입니다. : ' + file.name);
                return false;
            }

            // 파일크기 체크
            if (file.size > maxFileSize) {
                alert('10MB 이하의 파일을 첨부해주세요. : ' + file.name);
                return false;
            }

            return true;
        }

    </script>
</body>
</html>